import {generateVoronoiPoints, generateL1Voronoi} from "./src/voronoi.js";

let main = document.getElementById("main");
let diagram = document.getElementById("diagram");
let svg = document.getElementById("svg");
let canvas = diagram.getContext("2d");
let width = 400;
let height = 400;
diagram.height = height;
diagram.width = width;
svg.setAttribute("height", height);
svg.setAttribute("width", width);
let imageData = canvas.createImageData(width, height);

function randomNormal(sharpness){
    return new Array(sharpness).fill(0).map(e => Math.random()).reduce((c,e) => c + e, 0) / sharpness;
}

function generateData(number, round){
    let pointsSet = new Set();
    
    while(pointsSet.size < number){
        var x = round ? Math.floor(randomNormal(2) * width) : randomNormal(2) * width;
        var y = round ? Math.floor(randomNormal(2) * height) : randomNormal(2) * height;
        pointsSet.add(`[${x},${y}]`);
    }

    return Array.from(pointsSet.values()).map(e => JSON.parse(e));
}

let euclideanCallback = function(a,b){ return Math.sqrt(Math.pow(a[0] - b[0],2) + Math.pow(a[1] - b[1],2)) };
let manhattanCallback = function(a,b){ return Math.abs(a[0] - b[0]) + Math.abs(a[1] - b[1]) };

//let raw = generateData(128, true);
//let raw = new Array(128).fill(0).map(e => [Math.floor(randomNormal(2) * width), Math.floor(randomNormal(2) * height)]);
//let raw = new Array(32).fill(0).map(e => [randomNormal(2) * width, randomNormal(2) * height]);
//let raw = [[100,100],[175,175],[225,225],[300,300]];
//let raw = [[53,162],[61,185],[86,225],[95,164],[96,72],[98,267],[101,237],[105,217],[111,213],[118,117],[119,183],[136,267],[152,148],[167,276],[168,287],[183,69],[187,149],[193,225],[195,249],[220,119],[234,201],[239,215],[249,170],[268,306],[273,252],[279,173],[285,227],[308,273],[313,360],[319,43],[319,192],[360,196]];
//let raw = [[72,120],[79,272],[100,165],[101,194],[113,75],[115,242],[115,203],[123,202],[134,163],[136,167],[136,319],[150,206],[155,122],[160,207],[181,80],[181,304],[185,146],[192,223],[195,204],[222,82],[225,75],[236,85],[256,41],[264,186],[267,283],[268,213],[296,125],[304,264],[308,121],[313,165],[318,287],[336,187]];
//let raw = [[35,272],[37,325],[75,206],[77,81],[108,197],[115,200],[120,147],[132,321],[137,161],[152,174],[154,187],[166,339],[173,94],[189,288],[192,232],[206,365],[232,288],[247,191],[252,153],[254,357],[268,114],[271,172],[275,253],[309,237],[314,233],[317,169],[322,318],[336,210],[344,160],[375,152],[380,129],[380,327]];
//let raw = [[57,151],[99,227],[105,117],[106,319],[112,208],[115,166],[129,253],[130,319],[151,245],[170,214],[178,225],[182,169],[183,125],[189,63],[190,381],[192,108],[194,121],[201,188],[211,348],[211,298],[225,312],[226,191],[234,173],[245,230],[254,356],[267,216],[273,168],[274,223],[280,12],[285,192],[308,60],[352,207]];
//let raw = [[34,233],[63,23],[80,188],[94,209],[116,182],[126,212],[149,148],[151,306],[157,151],[170,327],[175,219],[177,149],[178,59],[179,269],[182,150],[189,73],[189,182],[206,165],[209,143],[216,131],[217,251],[225,180],[229,82],[229,98],[247,148],[247,202],[254,81],[260,164],[261,185],[282,386],[338,158],[357,330]];
//let raw = [[32,105],[51,60],[60,181],[93,119],[99,239],[113,135],[134,135],[137,386],[142,62],[159,118],[170,227],[170,215],[180,94],[186,163],[191,331],[192,69],[192,352],[195,84],[197,164],[201,263],[218,315],[219,138],[226,280],[229,248],[255,76],[266,290],[286,331],[304,230],[305,216],[330,132],[342,225],[379,236]];
//let raw = [[17,146],[27,321],[64,276],[80,203],[87,234],[109,337],[116,156],[128,327],[138,102],[142,328],[151,115],[153,311],[158,150],[163,132],[166,67],[184,181],[199,237],[204,191],[204,89],[225,64],[239,83],[244,113],[247,321],[259,131],[274,185],[280,275],[294,249],[319,203],[328,233],[367,205],[370,149],[371,151]];
//let raw = [[56,360],[79,189],[90,162],[101,130],[135,132],[141,240],[151,220],[155,112],[160,287],[170,139],[172,245],[176,148],[181,96],[189,266],[194,307],[198,183],[199,184],[210,102],[210,78],[221,122],[221,205],[229,179],[230,124],[246,88],[270,289],[280,210],[282,290],[283,251],[295,73],[326,179],[332,319],[347,180]];
//let raw = [[56,265],[88,240],[102,215],[119,159],[134,215],[140,188],[152,87],[176,143],[178,210],[181,93],[182,225],[194,238],[197,110],[204,250],[204,154],[218,170],[218,174],[229,333],[231,252],[243,197],[246,231],[249,201],[257,232],[268,114],[272,130],[290,146],[305,227],[307,220],[320,230],[322,150],[352,241],[365,237]];
//let raw = [[46,128],[57,314],[64,240],[92,311],[97,203],[103,193],[117,265],[124,202],[136,140],[151,147],[168,134],[183,283],[187,377],[187,330],[190,254],[196,231],[198,341],[205,169],[210,184],[213,212],[219,43],[224,180],[232,270],[249,307],[251,29],[273,80],[315,38],[330,288],[356,206],[359,163],[364,190],[372,112]];
//let raw = [[30,220],[39,214],[51,272],[79,140],[92,294],[113,276],[126,323],[131,66],[140,57],[151,306],[155,263],[165,100],[178,226],[190,59],[193,87],[197,250],[206,271],[209,212],[216,118],[231,234],[240,121],[252,175],[257,201],[261,382],[265,333],[277,286],[305,140],[313,180],[326,292],[333,126],[335,106],[394,157]];
//let raw = [[22,175],[65,159],[95,172],[111,153],[112,109],[141,175],[143,80],[155,343],[162,72],[165,223],[181,91],[183,176],[191,248],[192,106],[193,197],[205,136],[207,12],[211,227],[229,211],[242,261],[254,190],[256,244],[263,127],[264,166],[264,194],[277,353],[284,170],[298,100],[311,123],[323,181],[330,160],[334,189]];
//let raw = [[3,233],[3,232],[46,69],[95,377],[107,164],[108,94],[118,268],[131,311],[132,53],[140,177],[142,97],[143,123],[151,157],[161,76],[165,203],[193,189],[204,139],[221,161],[226,277],[227,262],[231,166],[231,214],[250,195],[251,261],[256,189],[256,138],[265,105],[295,91],[304,320],[352,214],[353,279],[353,203]];
//let raw = [[43,211],[60,124],[67,85],[73,160],[98,327],[101,154],[108,93],[114,129],[119,196],[120,254],[137,237],[143,157],[160,176],[166,293],[176,204],[180,230],[196,256],[206,165],[210,107],[212,317],[217,194],[219,183],[224,362],[229,192],[231,242],[247,313],[248,283],[256,183],[256,186],[277,210],[292,166],[342,271]];
//let raw = [[45,167],[45,239],[66,233],[71,189],[72,253],[79,100],[93,208],[93,109],[93,383],[94,40],[94,161],[98,216],[114,208],[124,155],[139,302],[143,245],[145,88],[156,270],[160,107],[165,272],[183,294],[186,130],[186,212],[187,234],[192,224],[192,113],[193,253],[194,169],[197,324],[201,166],[202,329],[202,212],[205,85],[205,127],[209,167],[211,371],[213,170],[215,217],[226,208],[231,15],[234,154],[235,124],[237,262],[239,195],[240,186],[242,266],[245,121],[245,277],[246,58],[252,189],[254,213],[255,313],[273,241],[280,106],[281,159],[289,284],[293,101],[295,309],[303,196],[306,100],[318,270],[326,231],[330,308],[355,137]];
//let raw = [[25,159],[26,145],[31,90],[32,43],[33,124],[35,66],[43,140],[51,173],[53,158],[53,254],[58,205],[69,239],[70,286],[70,130],[75,192],[104,224],[109,318],[111,55],[111,146],[114,155],[119,367],[120,268],[122,150],[128,252],[129,253],[132,180],[138,199],[141,252],[141,180],[143,294],[144,171],[147,201],[148,232],[151,307],[151,190],[153,13],[155,66],[156,33],[158,89],[158,162],[158,281],[159,264],[159,307],[162,208],[163,231],[164,208],[166,168],[168,140],[171,104],[174,205],[175,211],[176,191],[182,122],[193,239],[194,311],[195,90],[197,136],[197,200],[198,83],[199,333],[200,267],[201,142],[201,41],[201,152],[204,34],[209,59],[209,96],[209,257],[211,258],[213,249],[215,57],[217,127],[218,79],[219,201],[220,273],[220,249],[222,241],[223,73],[224,310],[225,198],[226,240],[226,146],[228,77],[228,174],[230,196],[230,271],[230,221],[233,90],[234,356],[234,171],[236,363],[236,278],[241,281],[249,254],[250,177],[257,177],[257,253],[258,262],[258,120],[262,256],[263,155],[266,111],[267,275],[270,247],[272,233],[273,201],[277,183],[278,191],[278,258],[282,125],[288,287],[293,215],[294,128],[294,25],[294,322],[300,167],[305,224],[315,105],[319,138],[321,219],[331,116],[335,235],[343,82],[345,161],[346,222],[348,293],[357,255],[374,177]];
//let raw = [[15,118],[22,226],[34,216],[37,260],[44,110],[50,223],[53,265],[56,116],[61,170],[61,219],[62,96],[63,269],[68,145],[71,277],[73,156],[93,89],[94,258],[96,321],[96,158],[98,139],[107,228],[111,109],[112,228],[117,188],[119,275],[125,225],[128,98],[130,197],[132,176],[135,325],[136,137],[137,264],[140,150],[140,272],[142,253],[144,155],[145,211],[146,198],[146,173],[151,186],[157,180],[158,108],[158,203],[163,207],[164,218],[165,309],[167,99],[167,72],[172,300],[173,301],[173,105],[174,67],[174,116],[177,144],[180,179],[181,161],[181,222],[188,16],[192,233],[192,96],[194,90],[195,285],[195,278],[196,212],[201,79],[201,179],[203,204],[203,197],[204,250],[204,134],[209,184],[210,265],[212,284],[213,205],[216,257],[217,65],[219,329],[220,315],[222,196],[223,163],[226,379],[230,272],[232,202],[236,182],[236,138],[239,206],[240,310],[243,369],[246,81],[247,364],[249,146],[252,229],[253,178],[258,192],[259,187],[262,145],[262,196],[263,193],[270,193],[274,141],[279,345],[279,36],[280,304],[281,210],[282,241],[282,93],[282,249],[284,77],[286,248],[287,189],[288,169],[296,253],[296,79],[300,118],[304,243],[308,272],[309,72],[311,241],[314,113],[316,211],[318,327],[321,154],[325,67],[327,167],[334,243],[350,228],[359,260],[397,89]];
//let raw = [[23,118],[40,154],[58,38],[69,246],[75,101],[75,235],[81,151],[82,263],[87,28],[89,164],[90,193],[91,84],[93,260],[96,176],[101,171],[106,190],[106,251],[107,221],[107,229],[109,125],[115,42],[116,171],[116,230],[118,249],[119,92],[121,169],[123,131],[124,91],[124,322],[132,176],[134,333],[136,170],[136,226],[140,86],[140,241],[141,180],[144,284],[146,173],[150,59],[150,200],[151,194],[154,200],[154,323],[154,361],[156,285],[160,96],[166,346],[168,312],[170,195],[174,90],[175,170],[176,108],[177,92],[179,148],[180,171],[185,214],[186,144],[188,247],[188,278],[188,304],[193,232],[198,84],[202,313],[202,322],[203,164],[203,252],[205,206],[205,215],[206,60],[206,241],[207,187],[213,226],[215,247],[219,55],[220,220],[221,233],[222,263],[222,300],[223,111],[224,118],[224,189],[226,209],[227,261],[228,238],[231,126],[231,185],[232,281],[233,289],[234,249],[239,157],[239,351],[240,168],[244,113],[244,272],[245,273],[246,191],[252,115],[259,163],[259,292],[262,203],[266,202],[269,208],[275,83],[276,91],[279,277],[282,243],[283,170],[286,242],[287,215],[290,136],[290,188],[292,187],[298,307],[300,232],[301,99],[305,125],[313,211],[313,321],[316,65],[316,281],[320,145],[330,243],[334,196],[334,345],[335,17],[347,115],[349,51],[359,191]];
//let raw = [[18,291],[37,105],[41,242],[53,221],[53,123],[64,268],[68,196],[69,87],[81,211],[82,255],[85,296],[96,206],[96,320],[101,159],[109,267],[111,36],[117,189],[117,110],[118,153],[118,259],[119,81],[126,164],[130,330],[138,192],[139,314],[141,257],[143,147],[144,90],[144,248],[146,172],[146,238],[146,224],[147,239],[148,312],[150,142],[151,223],[153,147],[153,221],[155,286],[157,299],[159,88],[163,171],[165,222],[165,256],[168,24],[170,247],[171,225],[172,37],[173,196],[174,366],[174,167],[176,215],[176,252],[177,266],[178,271],[178,292],[179,182],[181,203],[184,44],[185,126],[185,319],[186,307],[189,51],[190,373],[190,208],[191,176],[196,23],[198,159],[198,300],[200,88],[200,183],[201,141],[203,186],[204,185],[205,75],[206,194],[212,297],[216,333],[220,239],[227,238],[230,184],[234,324],[240,134],[240,201],[246,275],[246,164],[246,241],[250,317],[251,170],[253,107],[255,89],[257,385],[258,156],[259,120],[261,171],[263,160],[264,241],[269,175],[269,244],[272,229],[275,239],[275,299],[276,170],[276,244],[278,255],[279,113],[284,319],[288,122],[292,248],[294,248],[294,51],[295,217],[295,208],[309,70],[310,185],[323,195],[323,330],[327,92],[327,42],[337,259],[350,214],[353,256],[354,259],[354,234],[356,61],[360,117],[361,311],[374,354]];
//let raw = [[13,227],[17,234],[36,276],[39,189],[47,273],[54,169],[57,76],[61,108],[63,287],[67,162],[72,138],[76,190],[79,328],[79,250],[85,135],[85,215],[87,258],[91,315],[93,211],[93,206],[96,239],[102,154],[105,179],[109,316],[111,81],[112,273],[123,227],[123,144],[123,248],[123,248],[124,196],[131,203],[135,276],[145,251],[147,241],[148,249],[148,120],[149,74],[164,155],[165,245],[169,232],[175,129],[176,226],[176,206],[178,141],[179,119],[179,200],[183,293],[185,250],[186,136],[186,282],[187,171],[189,196],[189,30],[189,56],[190,296],[190,169],[192,146],[192,338],[193,194],[193,279],[196,188],[198,235],[200,84],[201,341],[202,238],[202,306],[203,216],[210,253],[212,276],[214,108],[217,296],[218,251],[219,188],[220,159],[220,19],[223,248],[225,159],[228,150],[229,145],[230,369],[231,234],[235,313],[237,161],[237,284],[238,227],[246,212],[252,317],[254,286],[254,22],[256,250],[257,141],[258,97],[261,294],[263,177],[264,324],[265,153],[269,207],[279,277],[286,189],[291,261],[291,222],[291,138],[292,295],[293,69],[299,179],[304,344],[307,214],[307,128],[312,210],[315,215],[315,114],[316,132],[316,266],[317,236],[318,269],[324,157],[327,162],[332,255],[340,161],[344,141],[348,275],[349,200],[355,120],[358,182],[366,113],[369,218],[379,169]];
//let raw = [[28,59],[29,287],[38,111],[64,45],[64,217],[65,101],[70,347],[77,185],[79,146],[80,156],[83,213],[83,196],[86,13],[87,201],[90,92],[100,76],[101,144],[107,227],[116,176],[120,278],[122,186],[122,220],[124,191],[129,78],[129,173],[130,168],[130,198],[135,193],[137,252],[137,181],[141,322],[141,20],[149,355],[150,147],[150,292],[151,294],[151,189],[151,219],[155,16],[155,195],[156,263],[157,106],[157,165],[159,349],[163,212],[164,190],[165,312],[173,166],[176,131],[178,176],[186,185],[189,222],[192,377],[194,168],[197,277],[197,252],[198,228],[198,142],[199,240],[201,151],[202,108],[203,94],[205,195],[207,243],[207,240],[208,119],[211,212],[212,82],[213,116],[213,76],[213,204],[213,272],[214,226],[217,90],[221,251],[222,53],[223,250],[224,216],[226,265],[226,167],[227,353],[230,151],[233,335],[236,317],[237,172],[241,262],[241,302],[242,336],[245,276],[247,101],[247,162],[248,301],[249,257],[249,255],[250,132],[256,189],[257,178],[261,324],[262,213],[273,128],[274,294],[276,124],[276,231],[277,154],[280,152],[281,36],[289,325],[295,230],[302,300],[304,297],[305,153],[308,34],[309,371],[313,152],[315,284],[316,54],[319,270],[323,258],[326,184],[331,59],[339,349],[340,212],[343,258],[352,246],[353,233],[365,33],[370,200],[375,173]];
//let raw = [[22,365],[24,183],[34,263],[38,328],[42,124],[49,337],[50,278],[55,260],[57,159],[65,45],[72,278],[80,271],[85,110],[89,54],[96,339],[96,162],[100,213],[113,267],[120,356],[126,265],[131,217],[132,327],[132,286],[133,151],[134,296],[137,194],[145,257],[146,254],[146,201],[147,92],[157,128],[160,162],[161,119],[162,62],[162,148],[162,347],[162,76],[162,101],[163,282],[163,142],[165,25],[168,92],[168,345],[170,234],[171,160],[173,68],[175,181],[176,92],[177,102],[178,266],[178,185],[181,8],[183,256],[189,256],[190,177],[191,233],[192,71],[193,152],[197,194],[205,244],[206,103],[206,215],[208,158],[208,350],[209,22],[211,217],[212,149],[214,156],[214,202],[217,84],[220,312],[220,105],[222,111],[225,160],[226,199],[226,135],[227,172],[227,66],[230,349],[232,164],[233,208],[236,314],[236,278],[239,304],[243,186],[244,290],[247,297],[249,110],[250,97],[251,130],[253,197],[257,345],[257,318],[263,238],[265,283],[267,260],[270,225],[272,285],[276,202],[277,206],[282,156],[284,322],[285,195],[286,71],[290,116],[291,189],[296,294],[300,289],[300,287],[301,216],[302,76],[303,195],[305,127],[309,309],[311,126],[312,284],[314,243],[320,198],[323,246],[324,340],[324,32],[324,210],[329,245],[334,284],[342,295],[357,271],[357,176],[384,91]];
//let raw = [[26,211],[31,224],[33,45],[38,125],[39,145],[47,289],[47,261],[54,238],[59,115],[61,170],[89,211],[89,184],[94,322],[98,155],[98,71],[99,360],[100,273],[103,342],[104,135],[111,29],[113,259],[115,166],[117,195],[121,112],[122,308],[123,182],[124,252],[125,142],[139,178],[141,274],[145,318],[147,208],[151,110],[153,201],[156,147],[156,324],[160,246],[161,329],[161,112],[165,248],[166,145],[170,243],[171,198],[172,84],[174,155],[174,80],[175,281],[178,124],[182,168],[183,264],[188,150],[190,201],[190,258],[191,305],[193,121],[193,280],[194,225],[195,122],[196,150],[197,231],[198,191],[199,309],[200,111],[205,106],[206,286],[208,15],[208,221],[208,168],[209,150],[210,153],[211,243],[212,312],[215,260],[216,155],[216,248],[217,190],[219,277],[221,316],[224,227],[227,224],[231,188],[232,195],[232,343],[232,247],[233,162],[233,156],[234,171],[238,52],[240,327],[243,257],[245,338],[252,27],[254,103],[260,169],[263,202],[263,74],[264,273],[266,344],[268,205],[270,217],[272,241],[275,209],[276,310],[282,208],[284,199],[286,237],[286,72],[292,208],[295,357],[305,152],[306,328],[309,278],[312,71],[320,324],[323,157],[328,19],[333,226],[336,251],[341,180],[342,311],[344,287],[346,112],[347,285],[349,30],[354,103],[355,209],[356,157],[366,210]];
//let raw = [[27,220],[37,126],[45,156],[50,303],[55,237],[63,190],[64,118],[66,30],[80,381],[80,86],[82,198],[83,90],[84,213],[84,155],[90,80],[94,121],[99,86],[101,310],[102,333],[102,31],[103,268],[107,201],[109,182],[109,311],[115,179],[118,332],[119,243],[120,357],[121,196],[123,363],[123,226],[124,348],[126,59],[129,165],[132,211],[133,108],[136,92],[136,296],[138,240],[139,124],[141,164],[144,201],[144,214],[146,264],[147,223],[149,350],[157,97],[161,219],[162,120],[164,191],[168,115],[169,295],[170,209],[173,325],[176,122],[176,149],[177,135],[177,131],[179,30],[181,87],[181,237],[184,206],[185,264],[186,225],[188,247],[191,197],[193,222],[196,154],[196,182],[197,172],[199,252],[201,298],[201,292],[201,314],[202,215],[202,302],[203,220],[206,181],[208,87],[209,264],[211,193],[212,173],[216,221],[216,320],[217,218],[219,126],[220,286],[222,220],[222,109],[222,159],[226,58],[231,358],[232,156],[233,261],[233,132],[234,153],[235,371],[235,87],[237,217],[243,160],[246,306],[249,229],[249,86],[252,57],[254,109],[255,111],[259,18],[260,200],[261,71],[274,220],[276,195],[284,309],[284,144],[285,239],[286,197],[291,292],[300,144],[303,266],[303,160],[312,279],[316,299],[317,160],[320,239],[341,259],[363,368],[368,224],[373,236],[378,226]];
//let raw = [[22,219],[50,164],[53,157],[60,198],[70,232],[74,220],[74,216],[76,193],[101,258],[101,181],[107,253],[109,172],[110,228],[111,143],[112,263],[114,342],[114,337],[114,236],[120,181],[124,368],[128,293],[128,188],[130,233],[131,241],[137,187],[140,274],[144,146],[156,282],[156,211],[157,220],[158,256],[159,135],[163,177],[164,145],[165,174],[165,153],[167,199],[169,206],[170,156],[172,25],[173,181],[176,225],[178,124],[179,179],[181,100],[181,305],[181,138],[182,299],[184,224],[185,345],[187,80],[188,246],[188,332],[193,139],[197,197],[201,35],[201,170],[203,248],[203,77],[206,143],[208,276],[208,228],[209,282],[209,286],[210,233],[211,69],[212,180],[212,208],[213,192],[213,190],[214,239],[218,172],[218,131],[219,270],[219,281],[219,307],[220,223],[220,213],[221,97],[222,346],[222,329],[227,184],[228,179],[228,269],[230,218],[234,289],[244,142],[245,164],[249,158],[250,282],[252,266],[254,236],[255,269],[257,248],[264,234],[267,196],[267,160],[268,119],[272,210],[276,183],[276,360],[279,206],[279,170],[280,290],[287,290],[292,171],[295,214],[299,95],[300,137],[301,83],[306,65],[312,146],[316,231],[321,182],[324,246],[330,203],[333,130],[336,99],[336,292],[338,265],[351,232],[353,93],[354,83],[354,51],[357,159],[361,44],[362,206],[389,101]];
//let raw = [[24,149],[28,328],[45,138],[47,40],[57,87],[57,177],[58,342],[59,123],[60,131],[73,72],[73,253],[73,30],[74,158],[78,192],[85,296],[88,320],[88,30],[96,147],[96,291],[97,201],[100,213],[100,312],[105,211],[109,102],[110,156],[113,193],[114,248],[115,183],[117,178],[118,300],[120,358],[120,191],[122,120],[126,284],[127,286],[131,111],[131,242],[133,319],[133,156],[134,228],[135,215],[136,166],[140,177],[140,272],[141,232],[143,174],[146,219],[147,204],[150,153],[158,47],[160,107],[160,166],[163,247],[167,338],[168,226],[171,194],[173,68],[173,255],[174,100],[176,74],[178,177],[179,193],[181,218],[183,150],[184,157],[186,316],[187,227],[193,305],[194,182],[194,33],[197,274],[200,65],[200,185],[200,164],[202,230],[204,93],[204,88],[204,89],[205,373],[207,176],[208,109],[209,232],[212,317],[213,222],[214,241],[214,194],[220,176],[224,242],[224,38],[228,136],[229,97],[231,147],[231,124],[234,248],[235,370],[236,50],[236,193],[237,136],[238,63],[240,213],[241,129],[243,352],[249,116],[252,282],[253,209],[261,313],[261,189],[262,167],[263,294],[274,233],[277,221],[278,68],[280,238],[281,235],[282,282],[284,189],[298,165],[298,215],[301,200],[306,18],[306,289],[313,150],[315,154],[319,136],[323,300],[325,340],[328,284],[363,194]];
//let raw = [[6,175],[35,49],[50,190],[51,229],[52,160],[53,237],[55,337],[55,241],[76,175],[78,223],[78,72],[82,372],[84,301],[97,214],[102,163],[104,93],[110,276],[111,279],[111,239],[112,280],[112,304],[114,257],[117,263],[120,160],[126,249],[126,284],[127,192],[128,238],[128,254],[137,149],[140,204],[143,115],[145,121],[150,292],[154,151],[156,186],[157,218],[162,120],[162,69],[165,112],[166,222],[167,152],[168,145],[171,362],[173,88],[173,157],[174,101],[180,251],[181,262],[181,247],[183,46],[186,157],[186,66],[187,152],[187,154],[188,245],[191,171],[193,320],[193,234],[194,295],[195,246],[195,222],[196,168],[202,167],[202,231],[206,269],[207,109],[210,303],[210,149],[210,258],[211,154],[215,375],[216,74],[216,244],[217,132],[220,107],[221,359],[224,169],[224,230],[227,104],[228,46],[229,236],[233,302],[234,87],[234,247],[235,197],[236,318],[241,194],[242,212],[244,190],[254,180],[254,301],[258,260],[259,208],[259,355],[260,236],[261,355],[261,324],[262,175],[266,322],[266,174],[267,242],[268,354],[269,250],[269,103],[270,281],[275,199],[275,152],[284,242],[288,264],[293,169],[296,185],[298,115],[304,328],[305,233],[307,109],[312,61],[313,380],[320,317],[321,271],[323,88],[326,281],[329,273],[354,199],[356,148],[359,216],[361,257],[387,81]];
//let raw = [[16,275],[64,117],[71,105],[71,108],[78,192],[79,271],[80,201],[82,103],[86,112],[86,343],[89,137],[106,340],[108,204],[112,339],[112,87],[115,119],[118,187],[119,154],[122,105],[125,149],[128,275],[131,223],[132,135],[140,267],[144,180],[146,36],[147,247],[149,319],[149,216],[150,182],[155,258],[155,206],[157,174],[158,213],[158,134],[158,86],[163,334],[165,155],[167,380],[169,61],[171,245],[174,214],[176,191],[178,327],[181,335],[181,177],[182,173],[189,179],[191,215],[192,279],[193,228],[198,285],[201,215],[203,196],[204,185],[204,34],[205,229],[210,218],[211,286],[213,289],[214,196],[214,99],[216,335],[217,75],[218,225],[218,178],[222,226],[231,201],[231,50],[235,116],[236,208],[236,301],[237,195],[237,116],[237,151],[238,260],[240,235],[240,250],[240,162],[242,176],[243,222],[243,314],[244,220],[246,115],[248,87],[249,49],[249,78],[252,260],[252,170],[252,116],[252,335],[253,98],[253,100],[254,204],[254,69],[258,267],[258,94],[262,129],[262,263],[264,201],[264,164],[267,115],[268,182],[269,278],[270,42],[273,269],[281,112],[283,48],[283,178],[285,292],[286,166],[293,316],[297,321],[299,248],[300,191],[302,292],[304,321],[308,177],[315,208],[318,348],[330,170],[334,305],[337,81],[347,23],[362,182],[363,239],[376,251],[380,163]];
//let raw = [[7,80],[8,54],[25,229],[32,281],[34,298],[43,287],[48,241],[51,39],[54,125],[54,241],[66,193],[67,117],[71,261],[72,129],[81,75],[81,217],[95,240],[96,137],[96,139],[100,197],[104,227],[104,125],[109,209],[110,59],[112,217],[112,248],[117,241],[119,129],[119,82],[120,292],[120,105],[125,97],[130,147],[131,358],[134,216],[139,173],[140,283],[142,254],[142,251],[143,359],[144,170],[144,179],[145,172],[153,216],[153,308],[154,103],[156,104],[156,185],[157,296],[157,386],[164,177],[165,338],[168,143],[172,289],[172,162],[172,100],[175,356],[176,173],[177,145],[178,178],[179,176],[181,256],[183,198],[183,144],[186,133],[186,223],[196,61],[196,339],[197,91],[199,63],[200,106],[203,132],[205,175],[205,172],[206,224],[209,238],[210,133],[211,256],[212,181],[217,156],[219,50],[221,172],[224,151],[224,121],[227,212],[227,353],[227,316],[230,194],[234,289],[236,137],[237,228],[238,258],[239,170],[239,233],[241,204],[242,231],[246,101],[247,257],[248,237],[249,64],[249,108],[250,367],[250,325],[253,152],[260,180],[268,272],[273,209],[275,116],[276,162],[277,241],[282,156],[284,112],[288,258],[289,175],[290,299],[292,130],[293,82],[293,127],[295,233],[295,63],[308,105],[308,133],[320,369],[332,207],[334,94],[349,269],[353,183],[367,305]];
let raw = [[12,148],[13,86],[23,297],[28,229],[30,214],[51,226],[52,287],[55,246],[55,129],[58,249],[61,172],[62,134],[64,138],[65,223],[66,364],[72,121],[72,299],[78,321],[78,158],[87,323],[87,127],[89,152],[91,210],[94,55],[96,185],[97,240],[97,177],[99,48],[99,95],[104,339],[114,218],[115,177],[121,221],[123,249],[128,158],[130,117],[132,251],[135,270],[135,137],[143,195],[143,251],[146,79],[149,203],[153,299],[153,120],[155,148],[159,256],[160,183],[160,194],[172,202],[175,270],[175,135],[175,145],[176,260],[177,212],[179,253],[180,252],[181,224],[183,307],[185,152],[189,103],[190,305],[192,89],[193,108],[194,162],[196,125],[201,31],[203,156],[203,128],[204,119],[205,155],[207,232],[209,59],[209,238],[213,92],[214,176],[215,318],[223,281],[224,116],[226,257],[231,180],[232,130],[233,146],[235,259],[236,59],[237,234],[240,199],[242,144],[247,130],[248,208],[250,299],[253,134],[260,141],[262,57],[263,188],[264,120],[264,138],[269,257],[270,325],[271,208],[271,84],[274,211],[277,152],[279,263],[284,172],[284,143],[291,360],[296,253],[297,198],[301,187],[302,125],[306,110],[309,175],[309,204],[309,177],[312,198],[317,184],[326,217],[326,102],[329,132],[339,125],[343,320],[346,166],[347,207],[355,59],[361,107],[372,131],[380,173]];
let sites = raw.slice(96,128);
console.log(JSON.stringify(sites.sort((a,b) => a[0] - b[0])));
console.log(sites.length);
document.getElementById("points").textContent = JSON.stringify(sites.sort((a,b) => {
    if(a[0] !== b[0]){
        return a[0] - b[0]
    }
    else{
        return a[1] - b[1]
    }
}), null);

let rawData = generateVoronoiPoints(sites ,width, height, manhattanCallback );
let vectorPoints = generateL1Voronoi(sites ,width, height);

for (var i=0;i<imageData.data.length;i+=4)
{
    imageData.data[i+0]=rawData[i/4][0];
    imageData.data[i+1]=rawData[i/4][1];
    imageData.data[i+2]=rawData[i/4][2];
    imageData.data[i+3]=255;
}

canvas.putImageData(imageData,0,0);

canvas.fillStyle = "#000000";

sites.forEach(e => {
    canvas.beginPath();
    canvas.arc(e[0], e[1], 1, 0, Math.PI * 2,);
    canvas.fill();
});

// draw svg shapes
vectorPoints.forEach(site =>{

    let filteredBisectors = site.bisectors.map(e => {
        if(e.compound){
            let plucked = e.points.find(d => d.site === site);
            plucked.mergeLine = e.mergeLine;
            return plucked;
        }
        else{
            return e;
        }
    })
    
    filteredBisectors.forEach(bisector => {
        var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'polyline'); //Create a path in SVG's namespace
        newElement.setAttribute("points", bisector.points.map(e => e.join(",")).join(" ")); //Set path's data
        newElement.setAttribute("parents", bisector.sites.map(e => e.site.join(",")).join(" | "));
        newElement.setAttribute("intersections", bisector.intersections.map(e => JSON.stringify(e)).join(" | "));
        newElement.setAttribute("site", site.site.join(","));
        newElement.style.stroke = bisector.mergeLine ? getColor(bisector.mergeLine) : "#000"; //Set stroke colour
        newElement.style.fill = "none";
        newElement.style.strokeWidth = "1px"; //Set stroke width
        svg.appendChild(newElement);

        bisector.intersections.forEach(intersect => {
            var intersectCirc = document.createElementNS("http://www.w3.org/2000/svg", 'circle'); //Create a path in SVG's namespace
            intersectCirc.setAttribute("cx", intersect[0]); //Set path's data
            intersectCirc.setAttribute("cy", intersect[1]); //Set path's data
            intersectCirc.setAttribute("r", 1); //Set path's data
            intersectCirc.style.fill = "#F00"; //Set stroke colour
            svg.appendChild(intersectCirc);
        });

    });
    
    /*
    var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
    newElement.setAttribute("d", site.d); //Set path's data
    newElement.setAttribute("class", "polygon"); //Set path's data    
    newElement.style.stroke = "#000"; //Set stroke colour
    newElement.style.strokeWidth = "1px"; //Set stroke width
    svg.appendChild(newElement);
    */
    /*
    var start = document.createElementNS("http://www.w3.org/2000/svg", 'circle'); //Create a path in SVG's namespace
    start.setAttribute("cx", site.polygonPoints[0][0]); //Set path's data
    start.setAttribute("cy", site.polygonPoints[0][1]); //Set path's data
    start.setAttribute("r", 2); //Set path's data
    start.style.fill = "#f00"; //Set stroke colour
    svg.appendChild(start);

    var end = document.createElementNS("http://www.w3.org/2000/svg", 'circle'); //Create a path in SVG's namespace
    end.setAttribute("cx", site.polygonPoints[site.polygonPoints.length - 1][0]); //Set path's data
    end.setAttribute("cy", site.polygonPoints[site.polygonPoints.length - 1][1]); //Set path's data
    end.setAttribute("r", 2); //Set path's data
    end.style.fill = "#f00"; //Set stroke colour
    svg.appendChild(end);
    */
    var groupCirc = document.createElementNS("http://www.w3.org/2000/svg", 'g'); //Create a path in SVG's namespace
    var siteCirc = document.createElementNS("http://www.w3.org/2000/svg", 'circle'); //Create a path in SVG's namespace
    var siteText = document.createElementNS("http://www.w3.org/2000/svg", 'text'); //Create a path in SVG's namespace
    groupCirc.setAttribute('transform', `translate(${site.site[0]},${site.site[1]})`);
    //siteCirc.setAttribute("cx", site.site[0]); //Set path's data
    //siteCirc.setAttribute("cy", site.site[1]); //Set path's data
    siteCirc.setAttribute("r", 3); //Set path's data
    siteText.setAttribute("y", -3);
    siteText.textContent = site.site.join(",");
    siteCirc.style.fill = "#000"; //Set stroke colour
    groupCirc.setAttribute("class", "site");
    groupCirc.appendChild(siteCirc);
    groupCirc.appendChild(siteText);
    svg.appendChild(groupCirc);
});

function getColor(color){
    switch(color){
        case 4:
            return "#4286f4";
        break;
        case 8:
            return "#44f453";
        break;
        case 16:
            return "#931d78";
        break;
        case 32:
            return "#ff3c35";
        break;
        case 64:
            return "#f4ad42";
        break;   
        case 128:
            return "#009182";
        break;   
        default:
            return "#000000";
    }
}

//main.textContent = JSON.stringify(vectorPoints, null, 4);